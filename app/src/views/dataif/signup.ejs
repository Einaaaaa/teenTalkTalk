<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Page</title>
  <link rel="stylesheet" href="/semantic/layout.css">
  <link rel="stylesheet" href="/semantic/semantic.min.css">
  <link rel="stylesheet" href="/css/home/layout.css">
  <script src="/ckeditor/build/ckeditor.js"></script>
</head>
<body>
  <div class='common-background-bar background-bar-memManage'></div>
  <div class='common-border-bar border-bar-memManage'></div>
  <%- include('../layout.ejs') %>
<section>
    <div>
        <div class="pagename">회원 등록</div>
        <div>
            <form action="/admin/auth/signup" method="post" name="frm_signup" id="frm_signup">
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">이름</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <input type="text" name="name" id="user_name" placeholder="이름">
                  </div>
                  <label class="one wide field">아이디</label>
                  <div class="four wide field">
                    <input type="text" name="userid" id="userid" placeholder="아이디">
                  </div>
                </div>
              </div>
              <br>
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">비밀번호</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <input name="password" id="user_password" type="password" placeholder="비밀번호">
                  </div>
                  <div class="four wide field">
                    <input name="password2" id="user_password2" type="password" placeholder="비밀번호 확인">
                  </div>
                </div>
              </div>
              <br>
              <!-- 드롭다운 -->
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">권한구분</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <select class="ui fluid dropdown" name="user_role" id="user_role">
                      <option value="0">사용자</option>
                      <option value="1">최고관리자</option>
                      <option value="2">부관리자</option>
                      <option value="3">정책관리자</option>
                    </select>
                  </div>
                  <label class="one wide field">회원구분</label>
                  <div class="four wide field">
                    <select class="ui fluid dropdown" name="user_type" id="user_type">
                      <%for(var i=0; i<code_data.user_type.length; i++){%>
                        <option value="<%=code_data.user_type[i].code_detail%>"><%=code_data.user_type[i].code_detail_name%></option>
                      <%}%>
                    </select>
                  </div>
                </div>
              </div>
              <br>
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">연령대</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <select class="ui fluid dropdown" name="parentsAge_code" id="parentsAge_code">
                      <%for(var i=0; i<code_data.parentsAge_code.length; i++){%>
                        <option value="<%=code_data.parentsAge_code[i].code_detail%>"><%=code_data.parentsAge_code[i].code_detail_name%></option>
                      <%}%>
                    </select>
                  </div>
                  <label class="one wide field">학교</label>
                  <div class="four wide field">
                    <select class="ui fluid dropdown" name="youthAge_code" id="youthAge_code">
                      <%for(var i=0; i<code_data.youthAge_code.length; i++){%>
                        <option value="<%=code_data.youthAge_code[i].code_detail%>"><%=code_data.youthAge_code[i].code_detail_name%></option>
                      <%}%>
                    </select>
                  </div>
                </div>
              </div>
              <br>
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">거주지</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <select class="ui fluid dropdown" name="emd_class_code" id="emd_class_code">
                      <%for(var i=0; i<code_data.emd_class_code.length; i++){%>
                        <option value="<%=code_data.emd_class_code[i].code_detail%>"><%=code_data.emd_class_code[i].code_detail_name%></option>
                      <%}%>
                    </select>
                  </div>
                  <label class="one wide field">성별</label>
                  <div class="four wide field">
                    <select class="ui fluid dropdown" name="sex_class_code" id="sex_class_code">
                      <option value="0">남자</option>
                      <option value="1">여자</option>
                      <option value="2">선택 안함</option>
                    </select>
                  </div>
                </div>
              </div>
              <br>
              <div class="ui form">
                <div class="inline fields">
                  <label class="one wide field">이메일</label>
                  <div class="four wide field" style="margin-right: 20px;">
                    <input type="text" name="user_email" id="user_email" placeholder="이메일">
                  </div>
                </div>
              </div>
              <br><br>
              <div>
                  <button class="ui button" type="submit" onclick="return btn()">등록</button>
                  <button class="ui button" type="button" onclick="return cancel()">취소</button>
              </div>
            </form>
            <script>
              document.getElementById("frm_signup").addEventListener('submit', function(event) {
                event.preventDefault();
                fetch('/admin/auth/signup', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  userid: document.getElementById("userid").value,
                  user_password: document.getElementById("user_password").value,
                  user_name: document.getElementById("user_name").value,
                  user_role: document.getElementById("user_role").value,
                  user_type: document.getElementById("user_type").value,
                  parentsAge_code: document.getElementById("parentsAge_code").value,
                  youthAge_code: document.getElementById("youthAge_code").value,
                  emd_class_code: document.getElementById("emd_class_code").value,
                  sex_class_code: document.getElementById("sex_class_code").value
                })
              }).then(response => response.json())
              .then(data => {
                if(data.code === 0){
                  alert("회원가입이 완료되었습니다.");
                  window.location.href = "/admin/dataif";
                }else{
                  alert(data.message);
                }
              })
              .catch(error => console.error('Error:', error));
              });
              </script>
        </div>
    </div>
</section>
</div>
<script>
  function btn() {
    if (document.getElementById("user_name").value.trim() === "") {
      alert("이름을 입력해주세요.");
      document.getElementById("user_name").focus();
      return false;
    }
    if (document.getElementById("userid").value.trim() === "") {
      alert("아이디를 입력해주세요.");
      document.getElementById("userid").focus();
      return false;
    }
    if (document.getElementById("user_password").value.trim() === "") {
      alert("비밀번호를 입력해주세요.");
      document.getElementById("user_password").focus();
      return false;
    }
    if (document.getElementById("user_password2").value.trim() === "") {
      alert("비밀번호 확인을 입력해주세요.");
      document.getElementById("user_password2").focus();
      return false;
    }
    if (document.getElementById("user_password").value !== document.getElementById("user_password2").value) {
      alert("비밀번호가 일치하지 않습니다.");
      document.getElementById("user_password").focus();
      return false;
    }
    if (document.getElementById("user_email").value.trim() === "") {
      alert("이메일을 입력해주세요.");
      document.getElementById("user_email").focus();
      return false;
    }
    if (!confirm("회원 등록 하시겠습니까?")) {
      return false;
    } else {
      // alert($("#user_name").value + "님 회원 등록 되었습니다.");
      return true;
    }
  }

  function cancel() {
    if (!confirm("입력 데이터를 취소하시겠습니까?")) {
      return false;
    } else {
      location.href = '/admin/dataif';
    }
  }
</script>
</body>
</html>
